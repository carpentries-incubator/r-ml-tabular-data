---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 03-Decision-Trees.md in _episodes_rmd/
source: Rmd
title: "Decision Trees"
teaching: 30 
exercises: 10
questions:
- "What are decision trees?"
- "How can we use a decision tree model to make a prediction?"
- "What are some shortcomings of decision tree models?"
objectives:
- "Introduce decision trees and recursive partitioning."
- "Revisit the Kyphosis example using a classification tree."
- "Introduce the problem of overfitting."
keypoints:
- "Training data can give us a decision tree model."
- "Decision trees are susceptible to overfitting."
---



## Decision Trees

TODO: describe the general idea of a decision tree.


~~~
library(tidyverse)
trainSize <- round(0.75 * nrow(kyphosis))
~~~
{: .language-r}



~~~
Error in nrow(kyphosis): object 'kyphosis' not found
~~~
{: .error}



~~~
set.seed(6789) # so we all get the same random sets
trainIndex <- sample(nrow(kyphosis), trainSize)
~~~
{: .language-r}



~~~
Error in nrow(kyphosis): object 'kyphosis' not found
~~~
{: .error}



~~~
trainDF <- kyphosis %>% slice(trainIndex)
~~~
{: .language-r}



~~~
Error in slice(., trainIndex): object 'kyphosis' not found
~~~
{: .error}



~~~
testDF <- kyphosis %>% slice(-trainIndex)
~~~
{: .language-r}



~~~
Error in slice(., -trainIndex): object 'kyphosis' not found
~~~
{: .error}

## Recursive Partitioning

TODO: Add exposition


~~~
library(rpart)
treeModel <- rpart(Kyphosis ~ Age + Number + Start, data = trainDF)
~~~
{: .language-r}



~~~
Error in is.data.frame(data): object 'trainDF' not found
~~~
{: .error}



~~~
par(xpd = TRUE)
plot(treeModel)
~~~
{: .language-r}



~~~
Error in plot(treeModel): object 'treeModel' not found
~~~
{: .error}



~~~
text(treeModel)
~~~
{: .language-r}



~~~
Error in text(treeModel): object 'treeModel' not found
~~~
{: .error}
Left child is yes, right child is no.



~~~
testDF[1:8,]
~~~
{: .language-r}



~~~
Error in eval(expr, envir, enclos): object 'testDF' not found
~~~
{: .error}


~~~
predict(treeModel, testDF[1:8,])
~~~
{: .language-r}



~~~
Error in predict(treeModel, testDF[1:8, ]): object 'treeModel' not found
~~~
{: .error}

## Check Accuracy

TODO: explain


~~~
predictedKyphosis <- ifelse(predict(treeModel, testDF)[,1] > 0.5, 
                            "absent", "present")
~~~
{: .language-r}



~~~
Error in predict(treeModel, testDF): object 'treeModel' not found
~~~
{: .error}



~~~
accuracy <- sum(testDF$Kyphosis == predictedKyphosis)/nrow(testDF)
~~~
{: .language-r}



~~~
Error in eval(expr, envir, enclos): object 'testDF' not found
~~~
{: .error}



~~~
cat("Proportion of correct predictions: ", accuracy, "\n")
~~~
{: .language-r}



~~~
Error in cat("Proportion of correct predictions: ", accuracy, "\n"): object 'accuracy' not found
~~~
{: .error}

TODO: Challenge: Try some other random seeds. Does the tree change?

TODO: Problem of overfitting; sensitivity to changes in the dataset.

---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 03-Decision-Trees.md in _episodes_rmd/
source: Rmd
title: "Decision Trees"
teaching: 30 
exercises: 10
questions:
- "What are decision trees?"
- "How can we use a decision tree model to make a prediction?"
- "What are some shortcomings of decision tree models?"
objectives:
- "Introduce decision trees and recursive partitioning."
- "Revisit the Kyphosis example using a classification tree."
- "Introduce the problem of overfitting."
keypoints:
- "Training data can give us a decision tree model."
- "Decision trees are susceptible to overfitting."
---



## Decision Trees

TODO: describe the general idea of a decision tree.


~~~
library(tidyverse)
library(rpart)
trainSize <- round(0.75 * nrow(kyphosis))
set.seed(6789) # so we all get the same random sets
trainIndex <- sample(nrow(kyphosis), trainSize)
trainDF <- kyphosis %>% slice(trainIndex)
testDF <- kyphosis %>% slice(-trainIndex)
~~~
{: .language-r}

## Recursive Partitioning

TODO: Add exposition


~~~
treeModel <- rpart(Kyphosis ~ Age + Number + Start, data = trainDF, 
                   method = "class",
                   control = list(cp = 0.01))
par(xpd = TRUE)
plot(treeModel)
text(treeModel)
~~~
{: .language-r}

<img src="../fig/rmd-03-unnamed-chunk-3-1.png" title="plot of chunk unnamed-chunk-3" alt="plot of chunk unnamed-chunk-3" width="612" style="display: block; margin: auto;" />
Left child is yes, right child is no.



~~~
testDF[1:8,]
~~~
{: .language-r}



~~~
  Kyphosis Age Number Start
1   absent 148      3    16
2   absent  22      2    16
3   absent 125      2    11
4   absent  93      3    16
5   absent   1      3     9
6  present  52      5     6
7   absent  20      6     9
8   absent 143      9     3
~~~
{: .output}


~~~
predict(treeModel, testDF[1:8,])
~~~
{: .language-r}



~~~
     absent    present
1 0.9444444 0.05555556
2 0.9444444 0.05555556
3 0.6111111 0.38888889
4 0.9444444 0.05555556
5 0.6111111 0.38888889
6 0.6111111 0.38888889
7 0.1428571 0.85714286
8 0.1428571 0.85714286
~~~
{: .output}

## Check Accuracy

TODO: explain


~~~
predictedKyphosis <- ifelse(predict(treeModel, testDF)[,1] > 0.5, 
                            "absent", "present")
accuracy <- sum(testDF$Kyphosis == predictedKyphosis)/nrow(testDF)
cat("Proportion of correct predictions: ", accuracy, "\n")
~~~
{: .language-r}



~~~
Proportion of correct predictions:  0.8 
~~~
{: .output}

TODO: Challenge: Try some other random seeds. Does the tree change?

TODO: Problem of overfitting; sensitivity to changes in the dataset.

TODO: Mushroom data set? parameter tuning?


